@model IEnumerable<HospitalDef.Models.Medicamento>

@{
    ViewData["Title"] = "Inventario de Medicamentos";
}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" />

<div class="container-fluid mt-4">

    <!-- ================= HEADER ================= -->
    <div class="card shadow-sm mb-4">
        <div class="card-body d-flex justify-content-between align-items-center">
            <div>
                <h3 class="fw-bold mb-0">
                    <i class="bi bi-capsule-pill text-primary"></i>
                    Inventario de Medicamentos
                </h3>
                <small class="text-muted">Gestión de existencias y control</small>
            </div>

            <a asp-controller="Medicamentoes" asp-action="Create" class="btn btn-primary rounded-pill">
                <i class="bi bi-plus-circle"></i> Agregar medicamento
            </a>

        </div>
    </div>

    <!-- ================= TABLA ================= -->
    <div class="card shadow-sm">
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead class="table-light">
                    <tr>
                        <th>Medicamento</th>
                        <th>Lote</th>
                        <th>Caducidad</th>
                        <th class="text-end">Compra</th>
                        <th class="text-end">Venta</th>
                        <th>Ubicación</th>
                        <th class="text-center">Stock</th>
                        <th class="text-center">Acciones</th>
                    </tr>
                </thead>

                <tbody>
                    @foreach (var item in Model)
                    {
                        <tr>
                            <td class="fw-semibold">@item.NombreMedicamento</td>
                            <td>@item.Lote</td>
                            <td>@item.Caducidad.ToString("dd/MM/yyyy")</td>
                            <td class="text-end">$@item.PrecioCompra</td>
                            <td class="text-end">$@item.PrecioVenta</td>
                            <td>@item.Ubicacion</td>

                            <td class="text-center">
                                <span class="badge rounded-pill
                                        @(item.Stock <= 5 ? "bg-danger" :
                                                                            item.Stock <= 10 ? "bg-warning text-dark" :
                                                                            "bg-success")">
                                @item.Stock
                            </span>
                        </td>

                            <td class="text-center">
                                <div class="btn-group btn-group-sm">
                                    <button class="btn btn-outline-primary"
                                            title="Editar"
                                            onclick="editarMedicamento(
                                                    @item.IdMedicamento,
                                                    '@item.NombreMedicamento',
                                                    '@item.Lote',
                                                    '@item.Caducidad.ToString("yyyy-MM-dd")',
                                                    @item.PrecioCompra,
                                                    @item.PrecioVenta,
                                                    '@item.Ubicacion',
                                                    @item.Stock)">
                                        <i class="bi bi-pencil-square"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        }
                </tbody>

            </table>
        </div>
    </div>
    <div class="mt-4 text-end">
        <a asp-controller="Farmaceuticoes"
           asp-action="Index"
           class="btn btn-outline-secondary rounded-pill px-4">
            <i class="bi bi-arrow-left"></i> Volver al módulo
        </a>
    </div>

</div>
<div class="modal fade" id="modalEditar" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content shadow">

            <form asp-controller="Medicamentoes" asp-action="Edit" method="post">
                <input type="hidden" name="IdMedicamento" id="editId" />

                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">
                        <i class="bi bi-pencil-square"></i> Editar medicamento
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body row g-3">
                    <div class="col-md-6">
                        <label class="form-label">Nombre</label>
                        <input id="editNombre" name="NombreMedicamento" class="form-control" />
                    </div>

                    <div class="col-md-6">
                        <label class="form-label">Lote</label>
                        <input id="editLote" name="Lote" class="form-control" />
                    </div>

                    <div class="col-md-4">
                        <label class="form-label">Caducidad</label>
                        <input type="date" id="editCaducidad" name="Caducidad" class="form-control" />
                    </div>

                    <div class="col-md-4">
                        <label class="form-label">Precio compra</label>
                        <input id="editCompra" name="PrecioCompra" class="form-control" />
                    </div>

                    <div class="col-md-4">
                        <label class="form-label">Precio venta</label>
                        <input id="editVenta" name="PrecioVenta" class="form-control" />
                    </div>

                    <div class="col-md-6">
                        <label class="form-label">Ubicación</label>
                        <input id="editUbicacion" name="Ubicacion" class="form-control" />
                    </div>

                    <div class="col-md-6">
                        <label class="form-label">Stock</label>
                        <input id="editStock" name="Stock" class="form-control" />
                    </div>
                </div>

                <div class="modal-footer">
                    <button class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button class="btn btn-primary">
                        <i class="bi bi-save"></i> Guardar cambios
                    </button>
                </div>

            </form>
        </div>
    </div>
</div>
<script>
    function editarMedicamento(id, nombre, lote, caducidad, compra, venta, ubicacion, stock) {
        document.getElementById("editId").value = id;
        document.getElementById("editNombre").value = nombre;
        document.getElementById("editLote").value = lote;
        document.getElementById("editCaducidad").value = caducidad;
        document.getElementById("editCompra").value = compra;
        document.getElementById("editVenta").value = venta;
        document.getElementById("editUbicacion").value = ubicacion;
        document.getElementById("editStock").value = stock;

        new bootstrap.Modal(document.getElementById("modalEditar")).show();
    }
</script>
