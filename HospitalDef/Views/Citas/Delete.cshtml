@model HospitalDef.Models.Cita

@{
    ViewData["Title"] = "Cancelar Cita";
}
@if (Model == null || Model.FolioCitas == 0)
{
    <div class="alert alert-danger shadow">No se encontró información de la cita.</div>
    <a asp-action="Index" class="btn btn-secondary mt-3">
        <i class="fas fa-arrow-left me-2"></i> Volver
    </a>
    return;
}


<div class="container py-5">
    <div class="row justify-content-center">

        <div class="col-lg-5 mb-4">
            @if (User.Identity.IsAuthenticated)
            {
                var nombre = User.FindFirst(System.Security.Claims.ClaimTypes.GivenName)?.Value ?? User.Identity.Name;

                <div class="card border-0 shadow-sm h-100 bg-light">
                    <div class="card-body p-4">
                        <div class="d-flex align-items-center mb-4 text-primary">
                            <div class="rounded-circle bg-white p-3 shadow-sm me-3">
                                <i class="fas fa-user-md fa-2x"></i>
                            </div>
                            <div>
                                <h4 class="fw-bold mb-0">Hola, @nombre</h4>
                                <small class="text-muted">Panel de Cancelación</small>
                            </div>
                        </div>

                        <div class="alert alert-warning border-0 shadow-sm" role="alert">
                            <h6 class="alert-heading fw-bold"><i class="fas fa-exclamation-triangle me-2"></i>Política de Reembolso</h6>
                            <hr>
                            <p class="mb-0 small">El monto a devolver depende de la anticipación con la que canceles:</p>

                            <ul class="list-group list-group-flush mt-3 bg-transparent">
                                <li class="list-group-item d-flex justify-content-between align-items-center bg-transparent px-0">
                                    <span><i class="far fa-clock me-2 text-success"></i>+ 48 Horas antes</span>
                                    <span class="badge bg-success rounded-pill">100% Reembolso</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center bg-transparent px-0">
                                    <span><i class="far fa-clock me-2 text-warning"></i>24 a 48 Horas</span>
                                    <span class="badge bg-warning text-dark rounded-pill">50% Reembolso</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center bg-transparent px-0">
                                    <span><i class="far fa-clock me-2 text-danger"></i>- 24 Horas</span>
                                    <span class="badge bg-danger rounded-pill">0% Reembolso</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            }
        </div>

        <div class="col-lg-6">
            <div class="card border-0 shadow-lg">
                <div class="card-header bg-white border-0 pt-4 px-4">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="fw-bold text-danger mb-0">¿Confirmar Cancelación?</h5>
                        <span class="badge bg-danger-subtle text-danger px-3 py-2 rounded-pill">Acción Irreversible</span>
                    </div>
                </div>

                <div class="card-body p-4">
                    <div class="mb-4 text-center">
                        <small class="text-muted text-uppercase fw-bold tracking-wide">Cita creada el</small>
                        <p class="lead fw-bold mb-0">@Html.DisplayFor(model => model.fechaCreacionCita)</p>
                    </div>

                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="p-3 border rounded-3 bg-light text-center h-100">
                                <i class="far fa-calendar-alt text-primary mb-2 fa-lg"></i>
                                <h6 class="text-muted mb-1">Fecha Programada</h6>
                                <span class="fw-bold d-block">@Model.fechaCita.ToShortDateString()</span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="p-3 border rounded-3 bg-light text-center h-100">
                                <i class="far fa-clock text-primary mb-2 fa-lg"></i>
                                <h6 class="text-muted mb-1">Hora Cita</h6>
                                <span class="fw-bold d-block">@Html.DisplayFor(model => model.horaCita)</span>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="p-3 border rounded-3 bg-light text-center h-100">
                                <i class="fas fa-hourglass-start text-secondary mb-2 fa-lg"></i>
                                <h6 class="text-muted mb-1">Inicio</h6>
                                <span class="fw-bold">@Html.DisplayFor(model => model.horaInicio)</span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="p-3 border rounded-3 bg-light text-center h-100">
                                <i class="fas fa-hourglass-end text-secondary mb-2 fa-lg"></i>
                                <h6 class="text-muted mb-1">Término</h6>
                                <span class="fw-bold">@Html.DisplayFor(model => model.horaTermino)</span>
                            </div>
                        </div>
                    </div>

                    <div class="mt-4">
                        <label class="small text-muted fw-bold">Estatus Actual</label>
                        <div class="d-flex align-items-center mt-1">
                            <span class="badge bg-info text-dark fs-6 px-3 py-2">
                                @Html.DisplayFor(model => model.estatusAtencion)
                            </span>
                            @Html.ValidationMessageFor(model => model.estatusAtencion, "", new { @class = "text-danger ms-2 small" })
                        </div>
                    </div>
                </div>

                <div class="card-footer bg-white border-0 p-4">
                    <form asp-action="Delete" class="d-grid gap-2">
                        <input type="hidden" asp-for="FolioCitas" />
                        <button type="submit" class="btn btn-danger btn-lg shadow-sm">
                            <i class="fas fa-trash-alt me-2"></i>Confirmar Cancelación
                        </button>

                        <a asp-action="Index" class="btn btn-outline-secondary btn-lg border-0">
                            <i class="fas fa-arrow-left me-2"></i>No, volver a la lista
                        </a>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        // Opcional: Confirmación con SweetAlert antes de enviar el form
        $('form').on('submit', function(e) {
            e.preventDefault();
            var form = this;

            Swal.fire({
                title: '¿Estás seguro?',
                text: "Esta acción no se puede deshacer y podría generar cobros.",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'Sí, cancelar cita',
                cancelButtonText: 'Volver'
            }).then((result) => {
                if (result.isConfirmed) {
                    form.submit();
                }
            });
        });
    </script>
}